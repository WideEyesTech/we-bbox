!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("Rx")):"function"==typeof define&&define.amd?define(["Rx"],e):"object"==typeof exports?exports.Bbox=e(require("Rx")):t.Bbox=e(t.Rx)}(this,function(t){return function(t){function e(n){if(a[n])return a[n].exports;var r=a[n]={exports:{},id:n,loaded:!1};return t[n].call(r.exports,r,r.exports,e),r.loaded=!0,r.exports}var a={};return e.m=t,e.c=a,e.p="",e(0)}([function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}var r=a(3),i=n(r),o=a(1),s=n(o),u=void 0,d=function(t){function e(t){function e(){v.innerHTML="",B.dispose&&B.dispose(),j.dispose&&j.dispose(),u=null}function a(t){g=t}function n(t){t.preventDefault(),R.style.zIndex=10,w=x(t,R);var e=void 0;return e=C.isEditPoint(w)?o:C.isInside(w)?d:h,i["default"].Observable.fromEvent(v,"mousemove").map(e).takeUntil(i["default"].Observable.fromEvent(v,"mouseup"))}function r(t){if(w=x(t),C.hasBbox()&&g){var e=C.getOrigin(),a=C.getFinal();g({x1:Math.round(e.x/k),y1:Math.round(e.y/k),x2:Math.round(a.x/k),y2:Math.round(a.y/k)})}return i["default"].Observable.fromEvent(v,"mousemove").takeUntil(i["default"].Observable.fromEvent(v,"mousedown"))}function o(t){var e=b(w,t);return w=x(t),{type:"resize",data:{origin:w,delta:e}}}function d(t){var e=b(w,t);return w=x(t),{type:"move",data:e}}function h(t){var e=y(w,t);return{type:"draw",data:e}}function c(t){switch(t.type){case"draw":C.draw(t.data.origin,t.data.width,t.data.height);break;case"move":C.move(t.data);break;case"resize":C.resize(t.data.origin,t.data.delta)}}function l(t){var e=x(t,v);if(C.isEditPoint(e)){var a=C.getEditPoint(e);R.style.cursor=a.style}else C.isInside(e)&&"move"!==R.style.cursor?R.style.cursor="move":C.isInside(e)||"crosshair"===R.style.cursor||(R.style.cursor="crosshair")}function f(t,e){var a=document.createElement("img");return k=e/t.width,a.src=t.src,a.width=t.width*k,a.height=t.height*k,{newImage:a,ratio:k}}function y(t,e){var a=b(t,e);return{origin:t,height:a.y,width:a.x}}function x(t){return m=R.getBoundingClientRect(),{x:Math.round(t.clientX-m.left),y:Math.round(t.clientY-m.top)}}function b(t,e){return m=R.getBoundingClientRect(),{x:Math.round(e.clientX-m.left-t.x),y:Math.round(e.clientY-m.top-t.y)}}var v=t.canvasContainer,M=t.img,m=void 0,p=void 0,g=void 0,w={x:0,y:0},k=1,E=M.width,z=v.offsetWidth;if(E>z){var O=f(M,z);p=O.newImage}else p=M;var I=document.createElement("canvas");I.width=Math.floor(p.width)-1,I.height=Math.floor(p.height)-1;var P=I.getContext("2d");P.drawImage(p,0,0,Math.floor(p.width),Math.floor(p.height));var R=document.createElement("canvas");R.width=Math.floor(p.width)-1,R.height=Math.floor(p.height)-1,R.style.position="absolute",R.style.left=0,R.style.cursor="crosshair",R.setAttribute("id","the_canvas");var _=document.createElement("div");_.style.height=R.height,_.style.margin="0 auto",_.style.position="relative",_.style.width=R.width;var C=(0,s["default"])({canvas:R});_.appendChild(I),_.appendChild(R),v.appendChild(_);var B=i["default"].Observable.fromEvent(R,"mousedown").flatMap(n).subscribe(c),j=i["default"].Observable.fromEvent(v,"mouseup").flatMap(r).subscribe(l);return i["default"].Observable.fromEvent(v,"mousemove").takeUntil(i["default"].Observable.fromEvent(v,"mousedown")).subscribe(l),{canvas:R,dispose:e,subscribe:a}}return u||(u=e(t)),u};t.exports=d},function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function r(t){function e(t){function e(){return I}function a(){return O}function n(){return Math.abs(P)>10&&Math.abs(R)>10}function r(t){var e=5,a=m.filter(function(a){return t.x>a.x-e&&t.x<a.x+e&&t.y>a.y-e&&t.y<a.y+e});return p=a[0]}function i(t){var e=5,a=m.filter(function(a){return t.x>a.x-e&&t.x<a.x+e&&t.y>a.y-e&&t.y<a.y+e});return a.length>0}function s(t){return t.x>Math.min(v.x,M.x)&&t.x<Math.max(v.x,M.x)&&t.y>Math.min(v.y,M.y)&&t.y<Math.max(v.y,M.y)}function u(t,e){switch(p.id){case 0:v=t,R=Math.round(Math.abs(R)-e.y),P=Math.round(Math.abs(P)-e.x);break;case 1:v={x:O.x,y:O.y+e.y},R=Math.round(Math.abs(R)-e.y),P=Math.abs(P);break;case 2:v=t,R=Math.round(Math.abs(R)-e.y),P=Math.round(-1*Math.abs(P)-e.x);break;case 3:v=O,R=Math.abs(R),P=Math.round(Math.abs(P)+e.x);break;case 4:v=t,R=Math.round(-1*Math.abs(R)-e.y),P=Math.round(-1*Math.abs(P)-e.x);break;case 5:v=O,R=Math.round(Math.abs(R)+e.y),P=Math.abs(P);break;case 6:v=t,R=Math.round(-1*Math.abs(R)-e.y),P=Math.round(Math.abs(P)-e.x);break;case 7:v={x:O.x+e.x,y:O.y},R=Math.abs(R),P=Math.round(Math.abs(P)-e.x)}M=y(v,P,R),l()}function d(t){v={x:v.x+t.x,y:v.y+t.y},M=y(v,P,R),l()}function h(t,e,a){v=t,R=a,P=e,M=y(v,P,R),l()}function c(){P=0,R=0,v={x:0,y:0},M={x:0,y:0},l()}function l(){m=[],k.globalAlpha=g,k.fillStyle="black",k.clearRect(0,0,w.width,w.height),k.fillRect(0,0,w.width,w.height),P&&R&&(k.clearRect(v.x,v.y,P,R),O=x(),I=b(),m.push(f({x:O.x,y:O.y},0,"nwse-resize")),m.push(f({x:I.x,y:O.y},2,"nesw-resize")),m.push(f({x:I.x,y:I.y},4,"nwse-resize")),m.push(f({x:O.x,y:I.y},6,"nesw-resize")),m.push(f({x:I.x-Math.abs(P)/2,y:O.y},1,"ns-resize")),m.push(f({x:I.x,y:I.y-Math.abs(R)/2},3,"ew-resize")),m.push(f({x:I.x-Math.abs(P)/2,y:I.y},5,"ns-resize")),m.push(f({x:O.x,y:I.y-Math.abs(R)/2},7,"ew-resize")))}function f(t,e,a){return(0,o["default"])({origin:t,id:e,style:a}).draw(k)}function y(t,e,a){return{x:Math.round(t.x+e),y:Math.round(t.y+a)}}function x(){return{x:Math.max(Math.min(v.x,M.x),0),y:Math.max(Math.min(v.y,M.y),0)}}function b(){return{x:Math.min(Math.max(v.x,M.x),w.width),y:Math.min(Math.max(v.y,M.y),w.height)}}var v=void 0,M=void 0,m=[],p={},g=.3,w=t.canvas,k=w.getContext("2d"),E=w.width,z=w.height,O=v={x:E/3,y:z/3},I=M={x:2*E/3,y:2*z/3},P=I.x-O.x,R=I.y-O.y;return l(),{draw:h,getEditPoint:r,getFinal:e,getOrigin:a,hasBbox:n,isEditPoint:i,isInside:s,move:d,reset:c,resize:u}}return e(t)}Object.defineProperty(e,"__esModule",{value:!0}),e["default"]=r;var i=a(2),o=n(i)},function(t,e){"use strict";function a(t){function e(t){return t.save(),t.globalAlpha=1,t.fillStyle=n.colors.background,t.strokeStyle=n.colors.stroke,t.lineWidth=n.lineWidth,t.beginPath(),t.arc(a.x,a.y,n.width/2,2*Math.PI,!1),t.stroke(),t.fill(),t.restore(),o}var a=t.origin,r=t.id,i=t.style,o={draw:e,id:r,style:i,x:a.x,y:a.y};return o}Object.defineProperty(e,"__esModule",{value:!0}),e["default"]=a;var n={colors:{background:"#333",stroke:"white"},lineWidth:3,width:8}},function(e,a){e.exports=t}])});